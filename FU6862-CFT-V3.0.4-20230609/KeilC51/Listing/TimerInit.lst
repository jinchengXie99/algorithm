C51 COMPILER V9.60.7.0   TIMERINIT                                                         08/30/2023 13:47:06 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMERINIT
OBJECT MODULE PLACED IN .\Output\TimerInit.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\User\Source\Hardware\TimerInit.c LARGE OMF2 WARNINGLEVEL(0) OPTIMIZE(
                    -9,SPEED) BROWSE INCDIR(..\User\Include;..\FU68xx_Hardware_Driver\Include) DEBUG PRINT(.\Listing\TimerInit.lst) TABS(2) O
                    -BJECT(.\Output\TimerInit.obj)

line level    source

   1          /*  -------------------------- (C) COPYRIGHT 2022 Fortiortech ShenZhen ---------------------------*/
   2          /**
   3           * @copyright (C) COPYRIGHT 2022 Fortiortech Shenzhen
   4           * @file      xxx.c
   5           * @author    Fortiortech  Appliction Team
   6           * @since     Create:2022-07-14
   7           * @date      Last modify:2022-07-14
   8           * @note      Last modify author is Leo.li
   9           * @brief      
  10           */
  11          
  12          
  13          /* Includes -------------------------------------------------------------------------------------*/
  14          #include <FU68xx_2.h>
  15          #include <Myproject.h>
  16          
  17          /* Private variables ----------------------------------------------------------------------------*/
  18          
  19          /** 
  20           * @brief       TIM0初始化配置
  21           * @data        2022/08/12
  22           */   
  23          void TIM0_Init(void)
  24          {
  25   1      }
  26          
  27          
  28          /** 
  29           * @brief       TIM1初始化配置
  30           * @data        2022/08/12
  31           */   
  32          void TIM1_Init(void)
  33          {
  34   1      }
  35          
  36          
  37          /** 
  38           * @brief       TIM2初始化配置
  39           * @data        2022/08/12
  40           */ 
  41          void TIM2_Init(void)
  42          {
  43   1          /*  -------------------------------------------------------------------------------------------------
  44   1              先停止计数，配置完寄存器后，最后启动计数
  45   1              -------------------------------------------------------------------------------------------------*
             -/
  46   1          ClrBit(TIM2_CR1, T2EN);                  // 0，停止计数；1,使能计数
  47   1          ClrBit(PH_SEL, T2SEL);             //0-不连接到端口GP11；1-连接到端口GP11
  48   1          /*  -------------------------------------------------------------------------------------------------
  49   1              时钟分频设置(T2PSC)
  50   1              000:cpuclk(24MHz)           001:cpuclk/2^1(12MHz)   010:cpuclk/2^2(6MHz)    011:cpuclk/2^3(3MHz)
  51   1              100:cpuclk/2^4(1.5MHz)  101:cpuclk/2^5(750KHz)  110:cpuclk/2^6(375KHz)  111:cpuclk/2^7(187.5KHz)
  52   1              -------------------------------------------------------------------------------------------------*
C51 COMPILER V9.60.7.0   TIMERINIT                                                         08/30/2023 13:47:06 PAGE 2   

             -/
  53   1           SetReg(TIM2_CR0, T2PSC0 | T2PSC1 | T2PSC2, T2PSC0 | T2PSC1);
  54   1          /*  -------------------------------------------------------------------------------------------------
  55   1              /模式选择
  56   1              T2MODE1，T2MODE0
  57   1              00--输入Timer模式；01--输出模式
  58   1              10--输入Count模式；11--QEP或者RSD模式
  59   1              -------------------------------------------------------------------------------------------------*
             -/
  60   1          SetReg(TIM2_CR0, T2MOD0 | T2MOD1, T2MOD0);
  61   1      
  62   1          /*  -------------------------------------------------------------------------------------------------
  63   1              清除中断标志位
  64   1              禁止PWM周期检测中断使能
  65   1              使能计数器上溢中断使能
  66   1              -------------------------------------------------------------------------------------------------*
             -/
  67   1          ClrBit(TIM2_CR0, T2CES);                               // 清零脉冲计数器不使能
  68   1          ClrBit(TIM2_CR1, T2IR | T2IF | T2IP);                  // 清零中断标志位
  69   1          SetBit(TIM2_CR1, T2IFE| T2IRE);                        //上溢中断使能
  70   1          /*  -------------------------------------------------------------------------------------------------
  71   1              配置周期值、比较值、计数值
  72   1              禁止PWM周期检测中断使能
  73   1              使能计数器上溢中断使能
  74   1              -------------------------------------------------------------------------------------------------*
             -/
  75   1          TIM2__ARR = 24000;                                                       // cpuclk(24MHz) 为1Ms上溢
             -中断
  76   1          TIM2__DR = TIM2__ARR;
  77   1          TIM2__CNTR = 0;
  78   1          /*-----------启动计数------------------------------------------------*/
  79   1          ClrBit(TIM2_CR1, T2EN);                                    //启动计数
  80   1      }
  81          
  82          
  83          /** 
  84           * @brief       TIM3初始化配置
  85           * @data        2022/08/12
  86           */ 
  87          void TIM3_Init(void)
  88          {
  89   1      /*-------------------------------------------------------------------------------------------------
  90   1        先停止计数，配置完寄存器后，最后启动计数
  91   1      -------------------------------------------------------------------------------------------------*/
  92   1        ClrBit(TIM3_CR1, T3EN);       // 0-停止计数；1-使能计数
  93   1      //  SetBit(PH_SEL, T3SEL);        //0-不连接到端口GP11；1-连接到端口GP11
  94   1      /*-------------------------------------------------------------------------------------------------
  95   1        时钟分频设置(T2PSC)
  96   1        000:cpuclk(24MHz)     001:cpuclk/2^1(12MHz) 010:cpuclk/2^2(6MHz)  011:cpuclk/2^3(3MHz)
  97   1        100:cpuclk/2^4(1.5MHz)  101:cpuclk/2^5(750KHz)  110:cpuclk/2^6(375KHz)  111:cpuclk/2^7(187.5KHz)
  98   1      -------------------------------------------------------------------------------------------------*/
  99   1        SetReg(TIM3_CR0,  T3PSC2 | T3PSC1 | T3PSC0,  T3PSC1 | T3PSC2);   // 375K
 100   1      
 101   1      /*-------------------------------------------------------------------------------------------------
 102   1        /模式选择
 103   1        0-输入模式
 104   1        1-输出模式
 105   1      -------------------------------------------------------------------------------------------------*/
 106   1        SetBit(TIM3_CR0, T3MOD);  
 107   1        
 108   1        ClrBit(TIM3_CR0, T3OCM);  
 109   1        
C51 COMPILER V9.60.7.0   TIMERINIT                                                         08/30/2023 13:47:06 PAGE 3   

 110   1      /*-------------------------------------------------------------------------------------------------
 111   1        /滤波时间
 112   1        00-不滤波；01-8个时钟周期
 113   1        10-16个时钟周期；11-32个时钟周期
 114   1      -------------------------------------------------------------------------------------------------*/
 115   1        SetReg(TIM3_CR1, T3FE1 | T3FE0, T3FE0);                              
 116   1      /*-------------------------------------------------------------------------------------------------
 117   1        清除中断标志位
 118   1        禁止PWM周期检测中断使能
 119   1        使能计数器上溢中断使能
 120   1      -------------------------------------------------------------------------------------------------*/
 121   1        ClrBit(TIM3_CR1, T3IR | T3IF | T3IP);                      // 清除中断标志位
 122   1        ClrBit(TIM3_CR1, T3IFE );                                 // 输入有效边沿变化中断使能和基本
             -数器上溢使能
 123   1        ClrBit(TIM3_CR0, T3IRE );                                 // 输入有效边沿变化中断使能和基本
             -数器上溢使能
 124   1      /*-------------------------------------------------------------------------------------------------
 125   1        定时器2中断优先级配置及芯片中断总使能
 126   1        PTIM31-PTIM30，中断优先级控制值从0-3依次表示优先级从最低到最高，共4级优化级
             -制
 127   1        EA,芯片中断总使能
 128   1      -------------------------------------------------------------------------------------------------*/
 129   1        PTIM31 = 0;
 130   1        PTIM30 = 1;                                            // TIM2/3中断优先级别为2
 131   1        EA = 1;
 132   1      
 133   1      /*-------------------------------------------------------------------------------------------------
 134   1        配置周期值、比较值、计数值
 135   1      -------------------------------------------------------------------------------------------------*/
 136   1        TIM3__CNTR = 1;
 137   1        TIM3__ARR = 6000;
 138   1        TIM3__DR = TIM3__ARR >> 1;  
 139   1        
 140   1        
 141   1      /*-----------关闭计数------------------------------------------------*/
 142   1        SetBit(TIM3_CR1, T3EN);           //关闭计数器
 143   1      }
 144          
 145          
 146          /** 
 147           * @brief       TIM4初始化配置
 148           * @data        2022/08/12
 149           */
 150          void TIM4_Init(void)
 151          {
 152   1          /*  -------------------------------------------------------------------------------------------------
 153   1              先停止计数，配置完寄存器后，最后启动计数
 154   1              -------------------------------------------------------------------------------------------------*
             -/
 155   1          ClrBit(TIM4_CR1, T4EN);           // 0-停止计数；1-使能计数
 156   1          SetBit(PH_SEL, T4SEL);              //0-不连接到端口GP01；1-连接到端口GP01
 157   1          /*  -------------------------------------------------------------------------------------------------
 158   1              时钟分频设置(T2PSC)
 159   1              000:cpuclk(24MHz)         001:cpuclk/2^1(12MHz)   010:cpuclk/2^2(6MHz)    011:cpuclk/2^3(3MHz)
 160   1              100:cpuclk/2^4(1.5MHz)    101:cpuclk/2^5(750KHz)  110:cpuclk/2^6(375KHz)  111:cpuclk/2^7(187.5KHz)
 161   1              -------------------------------------------------------------------------------------------------*
             -/
 162   1          SetReg(TIM4_CR0, T4PSC0 | T4PSC1 | T4PSC2, T4PSC0 | T4PSC1 | T4PSC2);
 163   1          /*  -------------------------------------------------------------------------------------------------
 164   1              /模式选择
 165   1              0-输入模式
 166   1              1-输出模式
C51 COMPILER V9.60.7.0   TIMERINIT                                                         08/30/2023 13:47:06 PAGE 4   

 167   1              -------------------------------------------------------------------------------------------------*
             -/
 168   1          ClrBit(TIM4_CR0, T4MOD);
 169   1          ClrBit(TIM4_CR0, T4OCM);      //     定时器比较匹配/捕获脉宽模式配置
 170   1          /*  -------------------------------------------------------------------------------------------------
 171   1              /滤波时间
 172   1              00-不滤波；01-8个时钟周期
 173   1              10-16个时钟周期；11-32个时钟周期
 174   1              -------------------------------------------------------------------------------------------------*
             -/
 175   1          SetReg(TIM4_CR1, T4FE1 | T4FE0, T4FE0);
 176   1          /*  -------------------------------------------------------------------------------------------------
 177   1              清除中断标志位
 178   1              禁止PWM周期检测中断使能
 179   1              使能计数器上溢中断使能
 180   1              -------------------------------------------------------------------------------------------------*
             -/
 181   1          ClrBit(TIM3_CR1, T4IR | T4IF | T4IP);                          // 清除中断标志位
 182   1          SetBit(TIM3_CR1, T4IPE | T4IFE);                                   // 输入有效边沿变化中断
             -能和基本计数器上溢使能
 183   1          /*  -------------------------------------------------------------------------------------------------
 184   1          
 185   1          
 186   1              与TIM1MS中断一起配置优先级，修改优先级时应注意
 187   1              -------------------------------------------------------------------------------------------------*
             -/
 188   1          //  PTIM4S1 = 0;
 189   1          //  PTIM4S0 = 1;                                                           // TIM4/5中断优先级别
             -为1
 190   1          //  EA = 1;
 191   1          /*  -------------------------------------------------------------------------------------------------
 192   1              配置周期值、比较值、计数值
 193   1              -------------------------------------------------------------------------------------------------*
             -/
 194   1          TIM4__CNTR = 0;
 195   1          TIM4__DR = 0;
 196   1          TIM4__ARR = 0;
 197   1          /*-----------启动计数------------------------------------------------*/
 198   1          SetBit(TIM3_CR1, T4EN);                 //使能计数器，启动计数
 199   1      }
 200          
 201          
 202          /** 
 203           * @brief       TIM1MS初始化配置
 204           * @data        2022/08/12
 205           */
 206          void TIM1ms_Init(void)
 207          {
 208   1          //SYST_ARR = 24000;     //计算公式：24M/SYST_ARR；例 24M/24000=1000Hz    SYST_ARR为SYS_TICK的
             -重载值
 209   1          PTIM4S1 = 0;
 210   1          PTIM4S0 = 1;                                                           // TIM4/5中断优先级别为1
 211   1          EA = 1;
 212   1          SetBit(DRV_SR, SYSTIE);                           // 使能1ms定时中断 ;
 213   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    195    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   TIMERINIT                                                         08/30/2023 13:47:06 PAGE 5   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
